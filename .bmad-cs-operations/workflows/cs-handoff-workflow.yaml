workflow:
  id: cs-handoff-workflow
  name: 타 부서 완전 이관
  description: 이관 평가 → 패키지 생성 → 전환 조정 → 고객 알림 → 사후 추적
  type: cs

  policy_notes:
    - 고객 알림 문안도 review-response/Sign-off 후 finalize-response 경유 가능(이메일/챗 발송 시)

  decision_points:
    - id: handoff_decision
      description: 이관 적격성 점수/기준에 따라 yes/no 결정
      branches:
        yes: 패키지 생성으로 진행
        no: 일반 처리/협업 경로로 복귀
    - id: human_signoff_on_handoff
      description: 이관 여부는 사람 Sign-off가 있어야 확정됨
      condition: assess-handoff-eligibility.report includes reviewer and signed_at
      branches:
        signed: 진행 가능
        missing: 재검토 요청
    - id: allow_send
      description: 고객 알림 발송 허용 여부 판단
      condition: pre-send preview의 content_hash == review-response Sign-off content_hash
      branches:
        allow_send: 발송 가능
        block_send: 프리뷰 재생성·재승인 필요

  guards:
    - name: required_metadata
      applies_to: [assess-handoff-eligibility, create-handoff-package, coordinate-transfer, notify-customer, track-post-handoff]
      checks: [case_id, updated_at, owner]
    - name: transfer_confirmation_signed
      applies_to: [coordinate-transfer]
      checks: [transfer_confirmation.content_hash]

  notes:
    - 전환 실패 시 롤백 플랜 가동, 고객 임시 안내 준비

  sequence:
    - agent: cs-intake
      action: intake-new-inquiry
    - agent: cs-handoff-processor
      action: assess-handoff-eligibility
    - agent: cs-handoff-processor
      action: create-handoff-package
    - agent: cs-handoff-processor
      action: coordinate-transfer
    - agent: cs-processor
      action: draft-response
      notes: 이관 안내 고객 공지 초안(필요 시)
    - agent: cs-quality
      action: review-response
      notes: 사람 Sign-off 필수(공지 발송 전)
    - agent: cs-processor
      action: finalize-response
      notes: pre-send preview 및 content_hash 대조, 발송 준비
    - agent: cs-handoff-processor
      action: notify-customer
    - agent: cs-handoff-processor
      action: track-post-handoff
