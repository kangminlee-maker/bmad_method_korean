workflow:
  id: cs-complex-case
  name: 복잡 케이스 처리
  description: 정책 해석/다부서 조정 포함, 협업·이관 경로와 결합될 수 있음
  type: cs

  policy_notes:
    - 고객 공지/답변 발송 전 review-response(사람 Sign-off) 및 pre-send preview/content_hash 대조

  decision_points:
    - id: need_coordination
      description: 정책 해석/다부서 협의 필요 여부 판단
      branches:
        coordinate: 부서 조정 필요
        proceed: 바로 처리 가능
    - id: allow_send
      description: 고객 발송 허용 여부 판단
      condition: pre-send preview의 content_hash == review-response Sign-off content_hash
      branches:
        allow_send: 발송 가능
        block_send: 프리뷰 재생성·재승인 필요

  guards:
    - name: required_metadata
      applies_to: [process-inquiry, draft-response, review-response, finalize-response]
      checks: [case_id, updated_at, owner]

  notes:
    - 규정 해석 분쟁 시 법무/컴플과 동시 협의, 보수적 문안 우선

  sequence:
    - agent: cs-intake
      action: intake-new-inquiry
    - agent: cs-collaboration-coordinator
      optional: true
      action: coordinate-departments
    - agent: cs-processor
      action: process-inquiry
    - agent: cs-processor
      action: draft-response
    - agent: cs-quality
      action: review-response
      notes: 사람 Sign-off 필수
    - agent: cs-processor
      action: finalize-response
      notes: pre-send preview 및 content_hash 대조
