# intake-new-inquiry

## 목적
- 고객 문의를 표준 형식으로 접수하고 기본 메타데이터(채널, 등급, 언어, 타임스탬프)를 기록합니다.
- 초기 정보가 부족한 경우 필요한 최소 정보를 유도해 누락 없이 수집합니다.

## 메타데이터 헤더(공통)
- 반드시 기록: `case_id`, `updated_at(ISO/타임존)`, `author`(작성 주체), `owner`(현재 소유자), `status_before`, `status_after`, `links[]`, `content_hash`(해당 시)

## 입력
- 채널: email | chat | phone
- 고객 식별자(익명화 토큰), 고객 등급(VIP/Standard 등), 언어(ko/en 등)
- 원문 메시지(제출 전 PII 마스킹 적용)

## 선행조건
- PII 마스킹 규칙 사용 가능(정규식/룰셋)
- 케이스 ID 발급 가능 상태(예: `case-YYYY-####`)

## 산출물
- 접수 기록: `cases/{case_id}-inquiry.md` (템플릿: `inquiry-record-tmpl.yaml`)
- 케이스 메타데이터(JSON) 업데이트(상태, 우선순위 초안, SLA 타깃)

## RBAC
- 수행: `cs-intake` 또는 지정된 접수 담당자
- 승인(필요 시): `cs-manager`

## SLA/우선순위(초안)
- 초기 접수 처리 목표: P1 15m, P2 60m, P3 4h
- 다음 조건 중 하나라도 충족하면 P1으로 즉시 지정합니다:
  1. 고객 등급이 VIP인 경우
  2. 결제/환불 관련 불만사항인 경우
  3. 공정위/공정거래위원회/소보원/소비자보호원 등 유사 기관에 신고하겠다는 내용이 포함된 경우
  4. 욕설 또는 감정이 격앙된 표현이 포함된 경우

  - 위 조건 판단은 임시로 키워드 기반 휴리스틱을 사용하며, `.bmad-cs-operations/data/priority-keywords.yaml`를 기준으로 합니다. 톤 감지 정책은 추후 데이터 도입 후 보강합니다. 키워드 파일은 `cs-manager` 소유, 주 1회 점검·갱신(긴급 시 수시)하며 변경 시 변경 이력과 롤백 지침을 함께 기록합니다.

## 단계별 지침
1) 채널/언어/고객등급/타임스탬프 캡처
2) 원문에서 민감정보(이메일/전화/결제수단/주민번호 등) 마스킹 확인(누락 시 보정)
3) 최소 필드 수집: 요약, 상세 내용, 희망 결과, 관련 식별자(마스킹), 첨부 여부
   - 동시에 위 P1 조건(1~4)을 키워드/메타데이터로 판정하여 충족 시 `priority=P1` 즉시 지정 및 타이머 시작
4) 템플릿 `inquiry-record-tmpl.yaml`로 접수 문서 생성 및 저장
5) 케이스 상태를 `new`로 설정하고 라우팅 대기 큐에 등록

## 상태 전이
- before: `uninitialized` → after: `new`
- guard: 최소 필드(요약/상세/희망결과), PII 마스킹 확인, 케이스 ID 발급

## 유도 질문(누락 시)
- 한두 줄로 요약해 주실 수 있나요?
- 원하는 처리 결과(환불/재발급/점검/설명 등)는 무엇인가요?
- 관련 주문/계정/결제 내역이 있다면 식별자(마스킹)로 알려주세요.

## 검증 체크리스트
- [ ] PII 마스킹이 완전하게 적용되었다
- [ ] 최소 필드(요약/상세/희망결과)가 수집되었다
- [ ] 케이스 ID/상태/초기 SLA 타깃이 설정되었다

## 자동 리마인드(필수 정보 미흡 시)
- 첫 요청 후 6h/24h 리마인드 템플릿 사용: “필수 정보 보완 요청(케이스ID 포함). 24h 초과 시 L1 에스컬레이션 예정.”
- 24h 초과 시 `cs-manager`에 L1 에스컬레이션 자동 생성

## 실패/에스컬레이션
- 필수 정보 미흡: 고객에게 추가 질문 발송, 24h 초과 시 L1 에스컬레이션
- 마스킹 실패 의심: 접수 보류 후 보안 담당에 알림

## 연계/핸드오프
- 다음 작업 후보: `classify-and-route`

## 예시
- 입력: VIP 고객, 이메일 채널, 제목 “결제 취소가 안 됩니다”, 본문에 “환불” 포함
- 처리: priority-keywords 매칭 → `priority=P1` 지정, `cases/CASE-1234-inquiry.md` 생성
- 산출: 상태 `new`, SLA 타깃 15m, 분류 대기

## 에지 케이스
- 고객 무응답: 6h/24h 리마인드 후 72h 경과 시 상태 `on-hold`, CS 매니저 승인 후 종결 검토
- 파일 첨부 손상/악성 의심: 수신 차단, 고객에 재전송 안내, 보안팀 통보
- 다국어 혼합 텍스트: 기본 언어를 감지해 기록, 필요 시 번역 태스크 생성
