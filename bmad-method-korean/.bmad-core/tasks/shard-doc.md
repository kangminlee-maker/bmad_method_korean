# 문서 분할 작업

## 목적

- 레벨 2 섹션을 기반으로 큰 문서를 여러 개의 작은 문서로 분할
- 분할된 문서를 구성하기 위한 폴더 구조 생성
- 코드 블록, 다이어그램, 마크다운 형식을 포함한 모든 콘텐츠 무결성 유지

## 기본 방법: markdown-tree를 사용한 자동화

[[LLM: 먼저 .bmad-core/core-config.yaml에서 markdownExploder가 true로 설정되어 있는지 확인하세요. 그렇다면 다음 명령을 실행해 보세요: `md-tree explode {입력 파일} {출력 경로}`.

명령이 성공하면 문서가 성공적으로 분할되었음을 사용자에게 알리고 중지하세요 - 더 이상 진행하지 마세요.

명령이 실패하면 (특히 명령을 찾을 수 없거나 사용할 수 없다는 오류가 표시되는 경우) 사용자에게 알리세요: "markdownExploder 설정이 활성화되어 있지만 md-tree 명령을 사용할 수 없습니다. 다음 중 하나를 수행하세요:

1. `npm install -g @kayvan/markdown-tree-parser`로 @kayvan/markdown-tree-parser를 전역으로 설치
2. 또는 .bmad-core/core-config.yaml에서 markdownExploder를 false로 설정

**중요: 여기서 중지하세요 - 위의 작업 중 하나가 수행될 때까지 수동 분할을 진행하지 마세요.**"

markdownExploder가 false로 설정된 경우 사용자에게 알리세요: "markdownExploder 설정이 현재 false입니다. 더 나은 성능과 신뢰성을 위해 다음을 수행해야 합니다:

1. .bmad-core/core-config.yaml에서 markdownExploder를 true로 설정
2. `npm install -g @kayvan/markdown-tree-parser`로 @kayvan/markdown-tree-parser를 전역으로 설치

이제 수동 분할 프로세스를 진행하겠습니다."

그런 다음 markdownExploder가 false인 경우에만 아래의 수동 방법을 진행하세요.]]

### 설치 및 사용법

1. **전역 설치**:

   ```bash
   npm install -g @kayvan/markdown-tree-parser
   ```

2. **explode 명령 사용**:

   ```bash
   # PRD의 경우
   md-tree explode docs/prd.md docs/prd

   # 아키텍처의 경우
   md-tree explode docs/architecture.md docs/architecture

   # 모든 문서의 경우
   md-tree explode [소스-문서] [대상-폴더]
   ```

3. **수행 작업**:
   - 레벨 2 섹션별로 문서를 자동으로 분할
   - 적절하게 명명된 파일 생성
   - 제목 수준을 적절히 조정
   - 코드 블록 및 특수 마크다운의 모든 엣지 케이스 처리

사용자가 @kayvan/markdown-tree-parser를 설치한 경우 이를 사용하고 아래의 수동 프로세스를 건너뛰세요.

---

## 수동 방법 (@kayvan/markdown-tree-parser를 사용할 수 없거나 사용자가 수동 방법을 지정한 경우)

### 작업 지침

1. 문서 및 대상 위치 식별

- 분할할 문서 결정 (사용자가 제공한 경로)
- `docs/` 아래에 문서와 동일한 이름(확장자 제외)의 새 폴더 생성
- 예: `docs/prd.md` → `docs/prd/` 폴더 생성

2. 섹션 구문 분석 및 추출

중요한 에이전트 분할 규칙:

1. 전체 문서 내용 읽기
2. 모든 레벨 2 섹션 (## 제목) 식별
3. 각 레벨 2 섹션에 대해:
   - 섹션 제목과 다음 레벨 2 섹션까지의 모든 내용 추출
   - 모든 하위 섹션, 코드 블록, 다이어그램, 목록, 표 등 포함
   - 다음에 특히 주의:
     - 펜스 코드 블록 (```) - 닫는 백틱을 포함한 전체 블록을 캡처하고 펜스 섹션 예제의 일부인 오해의 소지가 있는 레벨 2를 고려
     - Mermaid 다이어그램 - 완전한 다이어그램 구문 보존
     - 중첩된 마크다운 요소
     - 코드 블록 내부에 ##을 포함할 수 있는 여러 줄 콘텐츠

중요: 마크다운 컨텍스트를 이해하는 적절한 구문 분석을 사용하세요. 코드 블록 내부의 ##은 섹션 헤더가 아닙니다.]]

### 3. 개별 파일 생성

추출된 각 섹션에 대해:

1. **파일명 생성**: 섹션 제목을 소문자-대시-케이스로 변환
   - 특수 문자 제거
   - 공백을 대시로 교체
   - 예: "## Tech Stack" → `tech-stack.md`

2. **제목 수준 조정**:
   - 레벨 2 제목이 분할된 새 문서에서 레벨 1 (## 대신 #)이 됨
   - 모든 하위 섹션 수준이 1씩 감소:

   ```txt
     - ### → ##
     - #### → ###
     - ##### → ####
     - 등
   ```

3. **콘텐츠 작성**: 조정된 콘텐츠를 새 파일에 저장

### 4. 색인 파일 생성

분할된 폴더에 다음을 포함하는 `index.md` 파일 생성:

1. 원래 레벨 1 제목과 첫 번째 레벨 2 섹션 이전의 모든 콘텐츠 포함
2. 링크와 함께 모든 분할된 파일 나열:

```markdown
# 원본 문서 제목

[있다면 원본 소개 콘텐츠]

## 섹션

- [섹션 이름 1](./section-name-1.md)
- [섹션 이름 2](./section-name-2.md)
- [섹션 이름 3](./section-name-3.md)
  ...
```

### 5. 특수 콘텐츠 보존

1. **코드 블록**: 다음을 포함한 완전한 블록 캡처:

   ```language
   내용
   ```

2. **Mermaid 다이어그램**: 완전한 구문 보존:

   ```mermaid
   graph TD
   ...
   ```

3. **표**: 적절한 마크다운 표 형식 유지

4. **목록**: 들여쓰기와 중첩 보존

5. **인라인 코드**: 백틱 보존

6. **링크 및 참조**: 모든 마크다운 링크를 그대로 유지

7. **템플릿 마크업**: 문서에 {{placeholders}}가 포함된 경우 정확히 보존

### 6. 검증

분할 후:

1. 모든 섹션이 추출되었는지 확인
2. 콘텐츠가 손실되지 않았는지 확인
3. 제목 수준이 적절히 조정되었는지 확인
4. 모든 파일이 성공적으로 생성되었는지 확인

### 7. 결과 보고

요약 제공:

```text
문서가 성공적으로 분할되었습니다:
- 소스: [원본 문서 경로]
- 대상: docs/[폴더-이름]/
- 생성된 파일: [개수]
- 섹션:
  - section-name-1.md: "섹션 제목 1"
  - section-name-2.md: "섹션 제목 2"
  ...
```

## 중요한 참고사항

- 실제 콘텐츠를 수정하지 말고 제목 수준만 조정
- 중요한 경우 공백을 포함한 모든 형식 보존
- ## 기호를 포함하는 코드 블록이 있는 섹션과 같은 엣지 케이스 처리
- 분할이 가역적이어야 함 (분할에서 원본을 재구성할 수 있어야 함)
