# 브라운필드 스토리 생성 작업

## 목적

전통적인 분할된 PRD/아키텍처 문서가 존재하지 않을 수 있는 브라운필드 프로젝트를 위한 상세하고 구현 준비가 된 스토리를 생성합니다. 이 작업은 다양한 문서 형식(document-project 출력, 브라운필드 PRD, 에픽, 또는 사용자 문서)과 개발 에이전트를 위한 실행 가능한 스토리 사이의 간격을 연결합니다.

## 이 작업을 사용하는 경우

**이 작업을 사용하는 경우:**

- 비표준 문서가 있는 브라운필드 프로젝트 작업 시
- document-project 출력에서 스토리를 생성해야 하는 경우
- 전체 PRD/아키텍처 없이 브라운필드 에픽에서 작업하는 경우
- 기존 프로젝트 문서가 BMad v4+ 구조를 따르지 않는 경우
- 스토리 생성 중 사용자로부터 추가 컨텍스트를 수집해야 하는 경우

**create-next-story를 사용해야 하는 경우:**

- 적절히 분할된 PRD 및 v4 아키텍처 문서로 작업하는 경우
- 표준 그린필드 또는 잘 문서화된 브라운필드 워크플로우를 따르는 경우
- 모든 기술적 컨텍스트가 구조화된 형식으로 사용 가능한 경우

## 작업 실행 지침

### 0. 문서 컨텍스트

다음 순서로 사용 가능한 문서를 확인:

1. **분할된 PRD/아키텍처** (docs/prd/, docs/architecture/)
   - 발견되면 대신 create-next-story 작업 사용 권장

2. **브라운필드 아키텍처 문서** (docs/brownfield-architecture.md 또는 유사)
   - document-project 작업으로 생성됨
   - 실제 시스템 상태, 기술 부채, 해결 방법 포함

3. **브라운필드 PRD** (docs/prd.md)
   - 내장된 기술 세부사항을 포함할 수 있음

4. **에픽 파일** (docs/epics/ 또는 유사)
   - brownfield-create-epic 작업으로 생성됨

5. **사용자 제공 문서**
   - 사용자에게 위치와 형식 지정 요청

### 1. 스토리 식별 및 컨텍스트 수집

#### 1.1 스토리 소스 식별

사용 가능한 문서를 기반으로:

- **브라운필드 PRD에서**: 에픽 섹션에서 스토리 추출
- **에픽 파일에서**: 에픽 정의 및 스토리 목록 읽기
- **사용자 지시에서**: 구현할 특정 개선 사항을 사용자에게 문의
- **명확한 소스 없음**: 사용자와 함께 스토리 범위 정의

#### 1.2 필수 컨텍스트 수집

중요: 브라운필드 스토리의 경우 안전한 구현을 위해 충분한 컨텍스트를 수집해야 합니다. 누락된 정보를 사용자에게 문의할 준비를 하세요.

**필수 정보 체크리스트:**

- [ ] 어떤 기존 기능이 영향을 받을 수 있는가?
- [ ] 현재 코드와의 통합 지점은 무엇인가?
- [ ] 따라야 할 패턴은 무엇인가 (예시 포함)?
- [ ] 어떤 기술적 제약이 존재하는가?
- [ ] 알아야 할 "함정"이나 해결 방법이 있는가?

필수 정보가 누락된 경우, 누락된 정보를 나열하고 사용자에게 제공을 요청합니다.

### 2. 사용 가능한 소스에서 기술적 컨텍스트 추출

#### 2.1 Document-Project 출력에서

document-project의 brownfield-architecture.md를 사용하는 경우:

- **기술 부채 섹션**: 이 스토리에 영향을 미치는 해결 방법 기록
- **주요 파일 섹션**: 수정이 필요한 파일 식별
- **통합 지점**: 기존 통합 패턴 찾기
- **알려진 문제**: 스토리가 문제가 있는 영역을 건드리는지 확인
- **실제 기술 스택**: 버전 및 제약 사항 확인

#### 2.2 브라운필드 PRD에서

브라운필드 PRD를 사용하는 경우:

- **기술적 제약 섹션**: 모든 관련 제약 추출
- **통합 요구사항**: 호환성 요구사항 기록
- **코드 구성**: 지정된 패턴 따르기
- **위험 평가**: 잠재적 영향 이해

#### 2.3 사용자 문서에서

사용자에게 다음 식별 도움 요청:

- 관련 기술 사양
- 따를 기존 코드 예제
- 통합 요구사항
- 프로젝트에서 사용된 테스트 접근법

### 3. 점진적 세부사항 수집과 함께 스토리 생성

#### 3.1 초기 스토리 구조 생성

알려진 내용을 채워 스토리 템플릿 시작:

```markdown
# 스토리 {{개선 제목}}

## 상태: 초안

## 스토리

{{사용자 유형}}으로서,
나는 {{개선 기능}}을 원합니다,
{{제공되는 가치}}를 위해서.

## 컨텍스트 소스

- 소스 문서: {{문서 이름/유형}}
- 개선 유형: {{단일 기능/버그 수정/통합/등}}
- 기존 시스템 영향: {{간략한 평가}}
```

#### 3.2 승인 기준 개발

중요: 브라운필드의 경우 항상 기존 기능 유지에 대한 기준 포함

표준 구조:

1. 새 기능이 명시된 대로 작동
2. 기존 {{영향받는 기능}}이 변경 없이 계속 작동
3. {{기존 시스템}}과의 통합이 현재 동작 유지
4. {{관련 영역}}에서 회귀 없음
5. 성능이 허용 가능한 범위 내 유지

#### 3.3 기술 지침 수집

중요: 정보가 누락된 경우 사용자와 상호작용해야 하는 부분

사용 가능한 정보로 개발 기술 지침 섹션 생성:

````markdown
## 개발 기술 지침

### 기존 시스템 컨텍스트

[사용 가능한 문서에서 추출]

### 통합 접근법

[발견된 패턴 기반 또는 사용자에게 문의]

### 기술적 제약

[문서 또는 사용자 입력에서]

### 누락된 정보

중요: 개발자가 필요로 하지만 찾을 수 없는 것을 나열하고 누락된 정보 요청

### 4. 안전 검사와 함께 작업 생성

#### 4.1 구현 작업 생성

수집된 컨텍스트를 기반으로 다음을 포함하는 작업 생성:

- 시스템 이해가 불완전한 경우 탐색 작업 포함
- 기존 기능에 대한 검증 작업 추가
- 롤백 고려사항 포함
- 알려진 경우 특정 파일/패턴 참조

브라운필드용 예시 작업 구조:

```markdown
## 작업 / 하위 작업

- [ ] 작업 1: 기존 {{컴포넌트/기능}} 구현 분석
  - [ ] 현재 패턴을 위해 {{특정 파일}} 검토
  - [ ] 통합 지점 문서화
  - [ ] 잠재적 영향 식별

- [ ] 작업 2: {{새 기능}} 구현
  - [ ] {{예제 파일}}의 패턴 따르기
  - [ ] {{기존 컴포넌트}}와 통합
  - [ ] {{제약}}과의 호환성 유지

- [ ] 작업 3: 기존 기능 검증
  - [ ] {{기존 기능 1}}이 여전히 작동하는지 테스트
  - [ ] {{통합 지점}} 동작이 변경되지 않았는지 확인
  - [ ] 성능 영향 확인

- [ ] 작업 4: 테스트 추가
  - [ ] {{프로젝트 테스트 패턴}}을 따르는 단위 테스트
  - [ ] {{통합 지점}}에 대한 통합 테스트
  - [ ] 필요시 기존 테스트 업데이트
```
````

### 5. 위험 평가 및 완화

중요: 브라운필드의 경우 - 항상 위험 평가 포함

브라운필드별 위험에 대한 섹션 추가:

```markdown
## 위험 평가

### 구현 위험

- **주요 위험**: {{기존 시스템에 대한 주요 위험}}
- **완화**: {{해결 방법}}
- **검증**: {{안전 확인 방법}}

### 롤백 계획

- {{필요시 변경 사항을 되돌리는 간단한 단계}}

### 안전 검사

- [ ] 변경 전 기존 {{기능}} 테스트
- [ ] 변경 사항을 기능 플래그로 격리 가능
- [ ] 롤백 절차 문서화
```

### 6. 최종 스토리 검증

확정 전:

1. **완전성 확인**:
   - [ ] 스토리에 명확한 범위와 승인 기준이 있음
   - [ ] 구현을 위한 기술적 컨텍스트가 충분함
   - [ ] 통합 접근법이 정의됨
   - [ ] 위험이 완화와 함께 식별됨

2. **안전 확인**:
   - [ ] 기존 기능 보호 포함
   - [ ] 롤백 계획이 실현 가능
   - [ ] 테스트가 신규 및 기존 기능 모두 커버

3. **정보 격차**:
   - [ ] 모든 중요한 누락 정보를 사용자로부터 수집
   - [ ] 개발 에이전트를 위한 남은 미지수 문서화
   - [ ] 필요한 곳에 탐색 작업 추가

### 7. 스토리 출력 형식

적절한 이름으로 스토리 저장:

- 에픽에서 온 경우: `docs/stories/epic-{n}-story-{m}.md`
- 독립형인 경우: `docs/stories/brownfield-{기능-이름}.md`
- 순차적인 경우: 기존 스토리 번호 매기기 따르기

문서 컨텍스트를 나타내는 헤더 포함:

```markdown
# 스토리: {{제목}}

<!-- 소스: {{사용된 문서 유형}} -->
<!-- 컨텍스트: {{기존 시스템}}에 대한 브라운필드 개선 -->

## 상태: 초안

[스토리 내용의 나머지...]
```

### 8. 인계 커뮤니케이션

사용자에게 명확한 인계 제공:

```text
브라운필드 스토리 생성됨: {{스토리 제목}}

소스 문서: {{사용된 것}}
스토리 위치: {{파일 경로}}

식별된 주요 통합 지점:
- {{통합 지점 1}}
- {{통합 지점 2}}

기록된 위험:
- {{주요 위험}}

{{정보 누락된 경우}}:
참고: 일부 기술적 세부사항이 불분명했습니다. 스토리에는 구현 중 필요한 정보를 수집하기 위한 탐색 작업이 포함되어 있습니다.

다음 단계:
1. 정확성을 위해 스토리 검토
2. 통합 접근법이 시스템과 일치하는지 확인
3. 스토리 승인 또는 조정 요청
4. 그 후 개발 에이전트가 안전 검사와 함께 구현 가능
```

## 성공 기준

브라운필드 스토리 생성이 성공적인 경우:

1. 개발자가 여러 문서를 검색할 필요 없이 스토리를 구현할 수 있음
2. 통합 접근법이 명확하고 기존 시스템에 안전함
3. 사용 가능한 모든 기술적 컨텍스트가 추출되고 조직됨
4. 누락된 정보가 식별되고 해결됨
5. 위험이 완화 전략과 함께 문서화됨
6. 스토리가 기존 기능의 검증을 포함
7. 롤백 접근법이 정의됨

## 중요한 참고사항

- 이 작업은 비표준 문서가 있는 브라운필드 프로젝트를 위한 것입니다
- 항상 새 기능보다 기존 시스템 안정성을 우선시하세요
- 의심스러울 때는 탐색 및 검증 작업을 추가하세요
- 가정하는 것보다 사용자에게 명확화를 요청하는 것이 낫습니다
- 각 스토리는 개발 에이전트를 위해 자체 포함되어야 합니다
- 사용 가능한 경우 기존 코드 패턴에 대한 참조를 포함하세요
