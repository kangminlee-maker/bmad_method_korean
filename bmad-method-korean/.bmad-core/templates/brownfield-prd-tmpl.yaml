template:
  id: brownfield-prd-template-v2
  name: 브라운필드 개선 PRD
  version: 2.0
  output:
    format: markdown
    filename: docs/prd.md
    title: "{{project_name}} 브라운필드 개선 PRD"

workflow:
  mode: interactive
  elicitation: advanced-elicitation

sections:
  - id: intro-analysis
    title: 초기 프로젝트 분석 및 컨텍스트
    instruction: |
      중요 - 범위 평가 필요:
      
      이 PRD는 포괄적인 계획과 여러 스토리가 필요한 기존 프로젝트에 대한 중요한 개선사항을 위한 것입니다. 진행하기 전에:
      
      1. **개선 복잡성 평가**: 이것이 1-2개의 집중 개발 세션에서 완료될 수 있는 간단한 기능 추가나 버그 수정이라면, 중단하고 다음을 권장하세요: "더 간단한 변경의 경우, 제품 소유자와 함께 brownfield-create-epic 또는 brownfield-create-story 작업을 사용하는 것을 고려하세요. 이 전체 PRD 프로세스는 아키텍처 계획과 여러 조정된 스토리가 필요한 실질적인 개선사항을 위해 설계되었습니다."
      
      2. **프로젝트 컨텍스트**: 프로젝트가 이미 로드된 IDE에서 작업 중인지 또는 사용자가 프로젝트 정보를 제공해야 하는지 확인하세요. 프로젝트 파일을 사용할 수 있는 경우 docs 폴더의 기존 문서를 분석하세요. 문서가 충분하지 않은 경우 먼저 document-project 작업을 실행하는 것을 권장합니다.
      
      3. **심층 평가 요구사항**: 제안을 하기 전에 기존 프로젝트 구조, 패턴 및 제약사항을 철저히 분석해야 합니다. 모든 권장사항은 가정이 아닌 실제 프로젝트 분석에 근거해야 합니다.
      
      기존 프로젝트에 대한 포괄적인 정보를 수집하세요. 요구사항을 진행하기 전에 이 섹션을 완료해야 합니다.
      
      중요: 이 분석 전반에 걸쳐 사용자와 명시적으로 이해를 확인하세요. 기존 프로젝트에 대해 가정하는 모든 것에 대해 다음을 묻습니다: "분석을 기반으로 [가정]을 이해했습니다. 이것이 맞습니까?"
      
      사용자가 기존 시스템에 대한 이해를 검증할 때까지 권장사항을 진행하지 마세요.
    sections:
      - id: existing-project-overview
        title: 기존 프로젝트 개요
        instruction: document-project 분석이 이미 수행되었는지 확인하세요. 그렇다면 재분석 대신 해당 출력을 참조하세요.
        sections:
          - id: analysis-source
            title: 분석 소스
            instruction: |
              다음 중 하나를 표시:
              - Document-project 출력 사용 가능 위치: {{path}}
              - IDE 기반 새 분석
              - 사용자 제공 정보
          - id: current-state
            title: 현재 프로젝트 상태
            instruction: |
              - document-project 출력이 있는 경우: "상위 수준 아키텍처" 및 "기술 요약" 섹션에서 요약 추출
              - 그렇지 않은 경우: 프로젝트가 현재 수행하는 작업과 주요 목적에 대한 간략한 설명
      - id: documentation-analysis
        title: 사용 가능한 문서 분석
        instruction: |
          document-project가 실행된 경우:
          - 참고: "Document-project 분석 사용 가능 - 기존 기술 문서 사용"
          - document-project로 생성된 주요 문서 나열
          - 아래의 누락된 문서 확인 건너뛰기
          
          그렇지 않은 경우, 기존 문서 확인:
        sections:
          - id: available-docs
            title: 사용 가능한 문서
            type: checklist
            items:
              - 기술 스택 문서 [[LLM: document-project에서 가져온 경우 ✓ 체크]]
              - 소스 트리/아키텍처 [[LLM: document-project에서 가져온 경우 ✓ 체크]]
              - 코딩 표준 [[LLM: document-project에서 가져온 경우 부분적일 수 있음]]
              - API 문서 [[LLM: document-project에서 가져온 경우 ✓ 체크]]
              - 외부 API 문서 [[LLM: document-project에서 가져온 경우 ✓ 체크]]
              - UX/UI 가이드라인 [[LLM: document-project에 없을 수 있음]]
              - 기술 부채 문서 [[LLM: document-project에서 가져온 경우 ✓ 체크]]
              - "기타: {{other_docs}}"
            instruction: |
              - document-project가 이미 실행된 경우: "document-project 출력에서 기존 프로젝트 분석 사용."
              - 중요한 문서가 누락되고 document-project가 없는 경우: "먼저 document-project 작업을 실행하는 것을 권장합니다..."
      - id: enhancement-scope
        title: 개선 범위 정의
        instruction: 사용자와 협력하여 어떤 유형의 개선인지 명확하게 정의하세요. 이는 범위 지정과 접근 방식에 중요합니다.
        sections:
          - id: enhancement-type
            title: 개선 유형
            type: checklist
            instruction: 사용자와 함께 어떤 것이 적용되는지 결정
            items:
              - 새로운 기능 추가
              - 주요 기능 수정
              - 새로운 시스템과의 통합
              - 성능/확장성 개선
              - UI/UX 전면 개편
              - 기술 스택 업그레이드
              - 버그 수정 및 안정성 개선
              - "기타: {{other_type}}"
          - id: enhancement-description
            title: 개선 설명
            instruction: 사용자가 추가하거나 변경하려는 내용을 설명하는 2-3개 문장
          - id: impact-assessment
            title: 영향 평가
            type: checklist
            instruction: 기존 코드베이스에 미치는 영향 범위 평가
            items:
              - 최소 영향 (격리된 추가)
              - 중간 영향 (일부 기존 코드 변경)
              - 상당한 영향 (실질적인 기존 코드 변경)
              - 주요 영향 (아키텍처 변경 필요)
      - id: goals-context
        title: 목표 및 배경 컨텍스트
        sections:
          - id: goals
            title: 목표
            type: bullet-list
            instruction: 이 개선이 성공하면 제공할 1줄 원하는 결과의 글머리 목록
          - id: background
            title: 배경 컨텍스트
            type: paragraphs
            instruction: 이 개선이 필요한 이유, 해결하는 문제, 기존 프로젝트와 어떻게 맞는지 설명하는 1-2개의 짧은 단락
      - id: changelog
        title: 변경 로그
        type: table
        columns: [변경사항, 날짜, 버전, 설명, 작성자]

  - id: requirements
    title: 요구사항
    instruction: |
      기존 프로젝트에 대한 검증된 이해를 기반으로 기능 및 비기능 요구사항 초안을 작성하세요. 요구사항을 제시하기 전에 다음을 확인하세요: "이러한 요구사항은 기존 시스템에 대한 이해를 기반으로 합니다. 신중하게 검토하고 프로젝트의 현실과 일치하는지 확인하세요."
    elicit: true
    sections:
      - id: functional
        title: 기능적
        type: numbered-list
        prefix: FR
        instruction: 각 요구사항은 FR로 시작하는 식별자가 있는 글머리 마크다운이 됩니다
        examples:
          - "FR1: 기존 할 일 목록은 현재 기능을 중단하지 않고 새로운 AI 중복 감지 서비스와 통합됩니다."
      - id: non-functional
        title: 비기능적
        type: numbered-list
        prefix: NFR
        instruction: 각 요구사항은 NFR로 시작하는 식별자가 있는 글머리 마크다운이 됩니다. 기존 시스템의 제약사항 포함
        examples:
          - "NFR1: 개선사항은 기존 성능 특성을 유지하고 현재 메모리 사용량을 20% 이상 초과하지 않아야 합니다."
      - id: compatibility
        title: 호환성 요구사항
        instruction: 브라운필드에 중요 - 호환성을 유지해야 하는 것
        type: numbered-list
        prefix: CR
        template: "{{requirement}}: {{description}}"
        items:
          - id: cr1
            template: "CR1: {{existing_api_compatibility}}"
          - id: cr2
            template: "CR2: {{database_schema_compatibility}}"
          - id: cr3
            template: "CR3: {{ui_ux_consistency}}"
          - id: cr4
            template: "CR4: {{integration_compatibility}}"

  - id: ui-enhancement-goals
    title: 사용자 인터페이스 개선 목표
    condition: 개선에 UI 변경이 포함됨
    instruction: UI 변경의 경우, 기존 UI 패턴 및 디자인 시스템과 통합되는 방법을 캡처
    sections:
      - id: existing-ui-integration
        title: 기존 UI와의 통합
        instruction: 새로운 UI 요소가 기존 디자인 패턴, 스타일 가이드 및 컴포넌트 라이브러리와 어떻게 맞는지 설명
      - id: modified-screens
        title: 수정/새 화면 및 뷰
        instruction: 수정되거나 추가될 화면/뷰만 나열
      - id: ui-consistency
        title: UI 일관성 요구사항
        instruction: 기존 애플리케이션과의 시각적 및 상호작용 일관성을 유지하기 위한 특정 요구사항

  - id: technical-constraints
    title: 기술적 제약사항 및 통합 요구사항
    instruction: 이 섹션은 별도의 아키텍처 문서를 대체합니다. 기존 프로젝트 분석에서 상세한 기술적 제약사항을 수집하세요.
    sections:
      - id: existing-tech-stack
        title: 기존 기술 스택
        instruction: |
          document-project 출력을 사용할 수 있는 경우:
          - 상위 수준 아키텍처 섹션의 "실제 기술 스택" 테이블에서 추출
          - 버전 번호와 기록된 제약사항 포함
          
          그렇지 않은 경우, 현재 기술 스택 문서화:
        template: |
          **언어**: {{languages}}
          **프레임워크**: {{frameworks}}
          **데이터베이스**: {{database}}
          **인프라**: {{infrastructure}}
          **외부 종속성**: {{external_dependencies}}
      - id: integration-approach
        title: 통합 접근 방식
        instruction: 개선사항이 기존 아키텍처와 통합되는 방법 정의
        template: |
          **데이터베이스 통합 전략**: {{database_integration}}
          **API 통합 전략**: {{api_integration}}
          **프런트엔드 통합 전략**: {{frontend_integration}}
          **테스트 통합 전략**: {{testing_integration}}
      - id: code-organization
        title: 코드 구성 및 표준
        instruction: 기존 프로젝트 분석을 기반으로 새 코드가 기존 패턴에 맞는 방법 정의
        template: |
          **파일 구조 접근 방식**: {{file_structure}}
          **명명 규칙**: {{naming_conventions}}
          **코딩 표준**: {{coding_standards}}
          **문서 표준**: {{documentation_standards}}
      - id: deployment-operations
        title: 배포 및 운영
        instruction: 개선사항이 기존 배포 파이프라인에 맞는 방법
        template: |
          **빌드 프로세스 통합**: {{build_integration}}
          **배포 전략**: {{deployment_strategy}}
          **모니터링 및 로깅**: {{monitoring_logging}}
          **구성 관리**: {{config_management}}
      - id: risk-assessment
        title: 위험 평가 및 완화
        instruction: |
          document-project 출력을 사용할 수 있는 경우:
          - "기술 부채 및 알려진 문제" 섹션 참조
          - 개선에 영향을 줄 수 있는 "해결 방법 및 주의사항" 포함
          - "중요한 기술 부채"에서 식별된 제약사항 확인
          
          기존의 알려진 문제를 통합하여 위험 평가 구축:
        template: |
          **기술적 위험**: {{technical_risks}}
          **통합 위험**: {{integration_risks}}
          **배포 위험**: {{deployment_risks}}
          **완화 전략**: {{mitigation_strategies}}

  - id: epic-structure
    title: 에픽 및 스토리 구조
    instruction: |
      브라운필드 프로젝트의 경우, 사용자가 명확하게 여러 관련 없는 개선사항을 요청하지 않는 한 단일 포괄적 에픽을 선호하세요. 에픽 구조를 제시하기 전에 다음을 확인하세요: "기존 프로젝트 분석을 기반으로 이 개선사항은 [실제 프로젝트 분석을 기반으로 한 근거] 때문에 [단일 에픽/여러 에픽]으로 구성되어야 한다고 생각합니다. 이것이 필요한 작업에 대한 이해와 일치합니까?"
    elicit: true
    sections:
      - id: epic-approach
        title: 에픽 접근 방식
        instruction: 에픽 구조에 대한 근거 설명 - 일반적으로 관련 없는 여러 기능이 없는 한 브라운필드의 경우 단일 에픽
        template: "**에픽 구조 결정**: 근거와 함께 {{epic_decision}}"

  - id: epic-details
    title: "에픽 1: {{enhancement_title}}"
    instruction: |
      기존 기능을 유지하면서 브라운필드 개선을 제공하는 포괄적인 에픽
      
      브라운필드를 위한 중요한 스토리 순서:
      - 스토리는 기존 기능이 그대로 유지되도록 해야 합니다
      - 각 스토리에는 기존 기능이 여전히 작동하는지 확인이 포함되어야 합니다
      - 스토리는 기존 시스템에 대한 위험을 최소화하도록 순서를 정해야 합니다
      - 각 스토리에 대한 롤백 고려사항 포함
      - 빅뱅 변경보다는 점진적 통합에 집중
      - 기존 코드베이스 컨텍스트에서 AI 에이전트 실행을 위한 스토리 크기 조정
      - 필수: 완전한 스토리 순서를 제시하고 다음을 묻습니다: "이 스토리 순서는 기존 시스템에 대한 위험을 최소화하도록 설계되었습니다. 프로젝트의 아키텍처와 제약사항을 고려할 때 이 순서가 타당합니까?"
      - 스토리는 명확한 종속성이 식별된 논리적 순서여야 합니다
      - 각 스토리는 시스템 무결성을 유지하면서 가치를 제공해야 합니다
    template: |
      **에픽 목표**: {{epic_goal}}
      
      **통합 요구사항**: {{integration_requirements}}
    sections:
      - id: story
        title: "스토리 1.{{story_number}} {{story_title}}"
        repeatable: true
        template: |
          {{user_type}}로서,
          나는 {{action}}을 원한다,
          그래서 {{benefit}}.
        sections:
          - id: acceptance-criteria
            title: 수락 기준
            type: numbered-list
            instruction: 새로운 기능과 기존 시스템 무결성을 모두 포함하는 기준 정의
            item_template: "{{criterion_number}}: {{criteria}}"
          - id: integration-verification
            title: 통합 검증
            instruction: 기존 기능이 그대로 유지되도록 하는 특정 검증 단계
            type: numbered-list
            prefix: IV
            items:
              - template: "IV1: {{existing_functionality_verification}}"
              - template: "IV2: {{integration_point_verification}}"
              - template: "IV3: {{performance_impact_verification}}"
