workflow:
  id: cs-product-feedback
  name: 제품 피드백/버그 → PM 경로
  description: CS 분류에서 제품 경로로 분기하여 PM이 PRD/에픽/스토리를 생성하고 Dev로 위임
  type: cs

  policy_notes:
    - 고객 커뮤니케이션은 review-response(사람 Sign-off)와 pre-send preview/content_hash 대조 후 발송

  decision_points:
    - id: route_to_pm
      description: category in [product-bug, feature-request] 여부로 PM 경로 분기
      branches:
        to_pm: PM 경로로 진행
        general: 일반 경로로 복귀
    - id: allow_send
      description: 고객 발송 허용 여부 판단
      condition: pre-send preview의 content_hash == review-response Sign-off content_hash
      branches:
        allow_send: 발송 가능
        block_send: 프리뷰 재생성·재승인 필요

  guards:
    - name: required_metadata
      applies_to: [classify-and-route, create-product-brief, handoff-to-pm, notify-customer]
      checks: [case_id, updated_at, owner]

  notes:
    - PM 1차 판단 SLA 48h 권장, 고객 안내에 타임라인 반영

  sequence:
    - agent: cs-intake
      action: classify-and-route
      notes: category in [product-bug, feature-request] → to_pm
    - agent: cs-processor
      action: create-product-brief
    - agent: cs-processor
      uses: cs-product-handoff-checklist
      notes: 최소 요건 확인
    - agent: cs-processor
      action: handoff-to-pm
    - agent: pm
      action: create-prd
      notes: 커맨드 예시: @pm *create-prd (또는 *create-brownfield-prd)
    - agent: pm
      action: create-epic
      optional: true
    - agent: sm
      action: create
      notes: 샤딩된 PRD/아키텍처 기준으로 스토리 생성
    - agent: dev
      action: implement_story
      notes: 승인된 스토리 구현 → QA 리뷰
    - agent: qa
      action: review_implementation
      optional: true
    - agent: cs-intake
      action: notify-customer
      notes: 제품팀 접수/기획 착수 안내(승인/프리뷰 절차 준수)
